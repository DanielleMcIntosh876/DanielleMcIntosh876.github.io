<html>
<head>
  <meta name="mphtools-feature" content="compatibilityUI, cameraPrivacyPopup, compatibilityAutoCheck">
</head>
<body>
  <button style="display: block;  width: 100%; height: 50%;  border: none;  background-color: #1C603B;  color: white;  padding: 14px 28px;  font-size: 16px;  cursor: pointer;  text-align: center;" type="button" id="BeginButton" onclick="initRecog(this)">CLICK before you start</button>	
  <style>.embed-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; } .embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }</style><div class='embed-container'><iframe id= 'vid' src='https://www.youtube.com/embed//B5Fwl4P4EW8' frameborder='0' allowfullscreen></iframe></div>
  <p id= 'textBox'>Since 1972 scientists have been taking pictures of the earth’s surface using machines and for 20 years these were hard copy images. In 2008, the US government uploaded them online for free viewing and only then was there a revelation. On all the pictures, major areas of deforestation were noticed. This was done for logging, rubber production, cattle pastures, and most of all, to produce palm oil. Palm oil is found in many everyday items such as soaps, food etc.</p>
  <script src="https://thunkable.github.io/webviewer-extension/thunkableWebviewerExtension.js" type="text/javascript"></script>
  <script src="https://sdk.morphcast.com/mphtools/v1.0/mphtools.js"></script>
	<script src="https://ai-sdk.morphcast.com/v1.16/ai-sdk.js"></script>
	<script>
	
	let counters = [0, 0, 0, 0, 0];
	let counterNames = ["Happy", "Sad", "Angry", "Disgust", "Fear"];
	let checker = false;
	let link = '';
	let counter = 0;
	let endTracker = false;
	
	
	function videoList(currentIndex) {
		if (counter == 1){
			if (currentIndex != 0 && currentIndex != 4)
			{
				document.getElementById('textBox').innerText  = 'Since the election of President Jair Bolsonaro in Brazil, there has been a massive increase in deforestation of the Amazon rainforest. A section roughly the size of a soccer pitch is removed every minute which is dangerous as the Amazon is very important in the regulation of earth’s climate. It produces 20% of earth’s oxygen and is home to 1/10th of all species on earth. This deforestation is mainly occurring because Brazilian beef is in high demand worldwide and they are clearing these areas to make pastures to raise more cows. Unfortunately, decades of conservation efforts are now being reversed.';
				return 'https://www.youtube.com/embed//nYlnoxgqEWo'
			}
			else
			{
				document.getElementById('textBox').innerText  = "Rainforests help control rainfall worldwide. This is because during the water cycle, transpiration takes place, this is basically the release of water vapor from plants into the atmosphere. In rainforests there are so many plants, that high amounts of water vapor is released into the atmosphere which causes the precipitation process to speed up. The process becomes cyclical and the rainforests sort of act as a magnet for the rain, which is called, the biotic pump effect. However, if trees are removed, there is no transpiration process and clouds will “find” other areas to get water and the movement of these clouds to different areas means that there will be more rainfall in other areas where people live and whatnot. ";
				return 'https://www.youtube.com/embed//I0DWbRBYwuc'
			}
		}
		else if (counter == 2){
			if (currentIndex != 0 && currentIndex != 4)
			{
				document.getElementById('textBox').innerText  = "Forest area has been increasing around the world. However, cutting down of the “original” forests are still very damaging to the earth. Between 1982 and 2016, forest cover has gone up in certain regions but gone down in others, specifically in tropical areas. In the regions where it has increased, this was ,mainly due to human activity. ";
				return 'https://www.youtube.com/embed//soFeGPcJjPI'
			}
			else
			{
				document.getElementById('textBox').innerText  = "Forests cover 30% of the planet. With the rate of deforestation happening right now, earth’s rainforests can be completely gone within 100 years. This is harmful as when trees are cut down, the carbon dioxide that they are storing are released into the atmosphere and trees absorb a lot of the greenhouse gases that fuel global warming. Therefore, deforestation increases the speed and severity of global warming. Forests also provide a home for around 80% of plants and land animals. ";
				return 'https://www.youtube.com/embed//Ic-J6hcSKa8'
			}
		}
		else 
		{
			document.getElementById("BeginButton").textContent = "Click to Finish";
			document.getElementById('BeginButton').style.background='#FFCF00';
			endTracker = true; 
			document.getElementById('textBox').innerText  = ''; 
			return ''
		}
	}
		
	function initRecog(button){
		//vidShuffle(link);
	if(checker == true){
		document.getElementById("BeginButton").textContent = "CLICK ME TO BEGIN";
		document.getElementById('BeginButton').style.background='#1C603B';
		let max = Math.max(...counters);
		let maxIndex = counters.indexOf(max);
		//console.log(counterNames[maxIndex] + ": " + max);
		counter = counter + 1;
		document.getElementById('vid').src = videoList(maxIndex);
		ThunkableWebviewerExtension.postMessage(counter);
		checker = false;
		return;
	}
		document.getElementById('BeginButton').style.background='#FF2B2D';
		//document.getElementById('vid').src = link;
		
		CY.loader()
	   .licenseKey("ed6a12c60375cfd79dca1cb5dcc58fd0f684c0b62c2c")
	   .addModule(CY.modules().FACE_AGE.name)
	   .addModule(CY.modules().FACE_GENDER.name)
	   .addModule(CY.modules().FACE_EMOTION.name)
	   .load()
	   .then(({ start, stop }) => start());
	   
	window.addEventListener(CY.modules().FACE_EMOTION.eventName, (evt) => {
		if(evt.detail.output.dominantEmotion == "Happy"){
			counters[0] += 1;
		}
		if(evt.detail.output.dominantEmotion == "Sad"){
			counters[1] += 1;
		}
		if(evt.detail.output.dominantEmotion == "Angry"){
			counters[2] += 1;
		}
		if(evt.detail.output.dominantEmotion == "Disgust"){
			counters[3] += 1;
		}
		if(evt.detail.output.dominantEmotion == "Fear"){
			counters[4] += 1;
		}
	});
		checker = true;
		document.getElementById("BeginButton").textContent = 'Next Section';
		//button.style.visibility = "hidden";
	}
		
	</script>
</body>
</html>
